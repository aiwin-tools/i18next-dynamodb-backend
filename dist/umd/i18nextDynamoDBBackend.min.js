!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.i18nextDynamoDBBackend=n()}(this,function(){"use strict";function e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var t=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),a=function(){return{hash:"lang",tableName:"i18n",range:"namespace",documentClient:null,translationsKey:"data"}},i=function(){function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n(this,i),this.init(e,t,r),this.type="backend"}return r(i,[{key:"init",value:function(e,n,r){this.services=e,this.options=t({},a(),this.options,n),this.coreOptions=r}},{key:"read",value:function(n,t,r){var a=this.options,i=a.documentClient,o=a.hash,u=a.range,l=a.tableName,s=a.translationsKey;if(i){var c,f={TableName:l,Key:(c={},e(c,o,n),e(c,u,t),c),AttributesToGet:[s]};i.get(f).promise().catch(r).then(function(e){return r(null,e.Item&&e.Item[s])})}else r(null,null)}},{key:"_readMultiQueryBuilder",value:function(e,n){var t=this.options,r=t.hash,a=t.range,i=n.map(function(e,n){return"("+a+" = :namespace"+n+")"}).join(" or ");return e.map(function(e,n){return"("+r+" = :lang"+n+" and ("+i+")"}).join(" or ")}},{key:"readMulti",value:function(n,t,r){var a=this.options,i=a.range,o=a.tableName,u=a.documentClient,l=a.query,s=void 0===l?this._readMultiQueryBuilder(n,t):l;if(u){var c=this._readMultiExpressionAttributeValuesMapper(n,t),f={TableName:o,ScanIndexForward:!0,KeyConditionExpression:s,ExpressionAttributeValues:c,Select:"ALL"};u.query(f).promise()().catch(r).then(function(n){var t={};n.Items.forEach(function(n){t[n.language]=e({},i,{}),t[n.language][i]=n.translations}),r(null,t)})}else r(null,null)}}],[{key:"_readMultiExpressionAttributeValuesMapper",value:function(e,n){var t={};return e.forEach(function(e,n){t[":lang"+n]=e}),n.forEach(function(e,n){t[":namespace"+n]=e}),t}}]),i}();return i.type="backend",i});
